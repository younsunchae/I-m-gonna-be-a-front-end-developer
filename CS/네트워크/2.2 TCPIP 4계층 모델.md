# 인터넷 프로토콜 스위트 (Internet protocl suite)

인터넷에서 컴퓨터들이 서로 정보를 주고받는데 쓰이는 프로토콜의 집합이며, 이를 `TCP/IP 4계층 모델`로 설명하거나 `OSI 7계층 모델` 로 설명한다.

![](https://velog.velcdn.com/images/samuel_/post/306ad19a-6c38-462e-8f8b-af2fd0d767c5/image.png)

이 계층들은 특정 계측이 변경되었을 때 다른 계층이 영향을 받지 않도록 설계되었다.
<br/>

## 2.2.1 계층 구조

![](https://velog.velcdn.com/images/samuel_/post/62ab33dc-1450-4e24-8d86-fe64969c2a15/image.png)

### 💚 애플리케이션 계층

FTP, HTTP, SSH, SMTP, DNS 등 응용 프로그램이 사용되는 프로토콜 계층이며 웹 서비스, 이메일 등 서비스를 실직적으로 사람들에게 제공하는 층

> ### 💟 FTP <br/>
>
> 장치와 장치 간의 파일을 전송하는데 사용하는 표준 통신 프로토콜

> ### 💟 SSH <br/>
>
> 보안되지 않은 네트워크에서 네트워크 서비스를 안전하게 운영하기 위한 암호화 네트워크 프로토콜

> ### 💟 HTTP <br/>
>
> World Wide Web 을 위한 데이터 통신의 기초지이자 웹 사이트를 이용하는데 쓰는 프로토콜

> ### 💟 SMTP <br/>
>
> 전자 메일 전송을 위한 인터넷 표준 통신 프로토콜

> ### 💟 DNS <br/>
>
> 도메인 이름과 IP 주소를 매핑해주는 서버, 이를 통해 IP 주소가 바뀌어도 똑같은 도메인 주소(www.naver.com)로 서비스할 수 있다.

<br/>

### 💚 전송 계층

전송 계층은 송신자와 수신자를 연결하는 통신 서비스를 제공하며 연결 지향 데이터 스트림 지원, 신뢰성, 흐름제어를 제공할 수 있으며 애플리케이션과 인터넷 계층 사이의 데이터가 전달될 때 중계 역할을 한다.<br/>

#### 💟 가상회선 패킷 교환 방식

TCP는 패킷 사이의 순서를 보장하고 연결 지향 프로토콜을 사용해서 연결을 하여 신뢰성을 구축하며 수신 여부를 확인.<br/>
![](https://velog.velcdn.com/images/samuel_/post/348d25b7-bac9-4e5c-ba9f-d6f0845a6782/image.png)
각 패킷에서는 가상 회선 식별자가 포함되며 모든 패킷을 전송하면 가상 회선이 해제되고 패킷들은 전송된 순서대로 도착하는 방식

#### 💟 데이터그램 패킷 교환 방식

UDP는 `순서를 보장하지 않고` 수신 여부를 확인하지 않으며 단순히 데이터만 주는 이 방식을 사용.<br/>

![](https://velog.velcdn.com/images/samuel_/post/7c529e1a-578b-4555-9fb3-98d63af841d8/image.png)<br/>
패킷이 독립적으로 이동하며 `최적의 경로를 선택`하여 가는데 하나의 메세지에서 분할된 여러 패킷은 서로 다른 경로로 전송될 수 있고 `도착한 순서`가 다를 수 있다.

#### 💟 TCP 연결 성립 과정

TCP는 신뢰성을 확보할 때 `3-way handshake` 작업을 진행한다.<br/>
![](https://velog.velcdn.com/images/samuel_/post/af290af6-ae6a-43a3-8ac7-2c9f925d0dcf/image.png)

클라이언트와 서바가 통신할 때 세 단계의 과정을 거친다.<br/>
<br/>

1. SYN (SYNchronization 연결 요청 플래그)<br/>
   클라이언트는 서버에 클라이언트의 ISN(Initial Sequence Numbers 초기 네트워크 연결을 할 때 할당된 32비트 고유 시퀀스 번호)을 담아 SYN에 보낸다.<br/>
2. SYN + ACK(ACKnowledgement 응답 플래그)<br/>
   서버는 클라이언트의 SYN을 수신하고 서버의 ISN을 보내며 승인번호로 ISN+1 을 보낸다.<br/>
3. ACK <br/>
   클라이언트는 ISN + 1 한 값인 승인번호를 담아 ACK를 서버에 보낸다.<br/>
   <br/>

#### 💟 TCP 연결 해제 과정

TCP가 연결을 해제할 때는 `4-way handshake` 과정이 발생한다.<br/>
![](https://velog.velcdn.com/images/samuel_/post/9307e6d0-9156-4699-9f4a-c7cb353d5669/image.png)

<br/>

1. 클라이언트가 연결을 닫으려고 할때 FIN으로 설정된 세그먼트를 보내고 FIN_WAIT_1 상태로 들어가고 서버의 응답을 기다린다.<br/>
2. 서버는 클라이언트로 ACK 승인 세그먼트를 보내고 CLOSE_WAIT 상태에 들어간다. 세그먼트를 받으면 FIN_WAIT_2 상태로 들어간다.<br/>
3. 서버는 ACK를 보내고 일정 시간 이후에 클라이언트에 FIN이라는 세그먼트를 보낸다.<br/>
4. 클라이언트는 TIME_WAIT 상태가 되고 다시 서버로 ACK를 보내서 서버는 CLOSED 상태가 된다. 이후 클라이언트는 대기 한 후 연결이 닫히고 서버와 클라이언트의 모든 자원의 연결이 해제된다.

> ### 💟 TIME_WAIT<br/>
>
> `소켓이 바로 소멸되지 않고 일정 시간 유지되는 상태` 를 말하는데 지연 패킷이 발생할 경우 `데이터 무결성` 과 두 장치가 연결이 닫혔는지 확인하기 위해 일정 시간 지연 후 닫는다. <br/>

> ### 💟 데이터 무결성 <br/>
>
> 데이터의 정확성과 일관성을 유지하고 보증하는 것
> <br/>

### 💚 인터넷 계층

장치로부터 받은 네트워크 패킷을 IP주소로 지정된 목적지로 전송하기 위해 사용되는 계층이다.<br/>
IP, ARP, ICMP 등이 있으며 패킷을 수신해야 할 상대의 주소를 지정하여 데이터를 전달하고 상대방이 제대로 받았는지에 대해 보장하지 않은 비연결형적인 특징이 있다.<br/>
<br/>

### 💚 링크 계층

전선, 광섬유, 무선 등으로 실질적으로 `데이터를 전달하며 장치 간에 신호를 주고받는 규칙`을 정하는 계층이다. <br/>
`네트워크 접근 계층`이라고도 하며 이를 `물리계층과 데이터 링크 계층으로 나누기`도 하는데 물리 계층은 무선 LAN과 유선 LAN을 통해 0과 1로 이우러진 데이터를 보내는 계층이고, 데이터 링크 계층은 이더넷 프레임을 통해 에러확인, 접근제어, 흐름제어를 담당하는 계층이다. <br/>

#### 💟 전이중화 통신

![](https://velog.velcdn.com/images/samuel_/post/b2d71bd4-e66a-45f0-86a5-a0fbc1ef817c/image.png)<br/>

양쪽 장치가 동시에 송수신할 수 있는 방식 <br/>
송신로와 수신로로 나눠서 데이터를 주고 받으며 현대의 고속 이더넷은 이 방식을 기반으로 통신한다. <br/>

#### 💟 CSMA/CD

이전에는 유선 LAN에 `반이중화 통신` 중 하나인 Carrier Sense Mutiple Access with Collision Detection 방식을 썼다. 이 방식은 데이터를 보낸 이후 `충돌이 발생한다면 일정 시간 이후 재전송하는 방식`이다. 한 경로를 기반으로 데이터를 보내기 때문에 데이터를 보낼 때 충돌에 대비해야 했기 때문이다. <br/>

#### 💟 유선 LAN을 이루는 케이블

1. 트위스트 페어 케이블<br/>
   ![](https://velog.velcdn.com/images/samuel_/post/4b4d51fb-697d-46aa-96bf-95a8988cce8d/image.png)<br/>
   하나의 케이블처럼 보이지만 실제로는 8개의 구리선을 2개씩 꼬아 묶은 테이블<br/>
   우리가 많이 보는 케이블은 UTP 케이블로 흔히 LAN 케이블이라고 한다. <br/>

2. 광섬유 케이블<br/>
   ![](https://velog.velcdn.com/images/samuel_/post/d63786dc-a9cf-418b-91bc-56ffcd5b834b/image.png)<br/>
   광섬유로 만든 케이블<br/>
   레이저를 이용해서 통신하기 때문에 구리선과는 비교할 수 없을 만큼의 `장거리 및 고속 통신이 가능`<br/>
   한 번 들어간 빛이 내부세어 계속적으로 반사하며 전진하여 반대편 끝까지 가는 원리 <br/>
   코어 : 굴절률이 높은 부분<br/>
   클래딩 : 굴절률이 낮은 부분 <br/>

#### 💟 반이중화 통신

무선 LAN은 송신과 수신에 같은 채널을 이용하기 때문에 `반이중화 통신 (half duplex)`을 사용
반이중화 통신은 양쪽 장치는 서로 통신할 수 있지만, 동시에는 통신할 수 없으며 한번에 한 방향만 통신할 수 있는 방식<br/>
전송이 완료 될때 까지 기다려야 하기 때문에 `충돌 방지 시스템`이 필요하다.<br/>

> ### 💟 CSMA/CA<br/>
>
> 1.  데이터를 보내기 전 무선 매체 살피기
> 2.  캐리어 감지로 회선이 비어 있는지 판단
> 3.  IFS(Inter FrameSpace) : 랜덤 값을 기반으로 정해진 시간만큼 기다리며 무선 매체가 사용중이면 그 간격을 늘려가며 기다림 <br/>
>     하는 방식으로 사전에 가능한 한 `충돌을 방지`

#### 💟 무선 LAN

공기에 주파수를 쏘아 통신망을 구축하는데, 2.4GHz는 장애물에 강하지만 전파간섭이 일어날 수 있는 반면에, 5GHz 대역은 사용할 수 있는 채널 수도 많고 동시에 사용할 수 있기 때문에 5GHz를 사용하는 것이 좋다.

#### 1. WIFI

전자기기들이 무선 LAN 신호에 연결할 수 있게 하는 기술로 무선 접속 장치(AP, Access Point)가 필요하다. 이를 공유기라고도 하며 이를 통해 유선 LAN에 흐르는 신호를 무선 LAN 신호로 바꿔주어 신호가 닿는 범위내에서 무선 인터넷을 사용할 수 있게 된다.

#### 2. BSS(Basic Service Set)

기본 서비스 집합을 의미하며 단순 공유기를 통해 네트워크에 접속하는 것이 아닌 동일 BSS 내에 있는 AP들과 장치들이 서로 통신이 가능한 구조를 말한다.

#### 3. ESS(Extended Service Set)

![](https://velog.velcdn.com/images/samuel_/post/219e6e94-a4e6-41c0-84e1-b6a855ca7e52/image.png)<br/>

하나 이상의 연결된 BSS 그룹, 장거리 무선 통신을 제공하며 BSS보다 더 많은 가용성과 이동성을 지원하기 때문에 한 장소에서 다른 장소로 이동해도 중단 없이 네트워크에 계속 연결이 가능하다.

#### 💟 이더넷 프레임

![](https://velog.velcdn.com/images/samuel_/post/440d5b0e-651f-4d57-88b3-1c1f7363fb5b/image.png)<br/>
데이터 링크 계층은 이더넷 프레임을 통해 전달받은 데이터의 에러를 검출하고 캡슐화하여 다음과 같은 구조를 가진다.<br/>

- Preamble : 이더넷 프레임이 시작임을 알린다.
- SFD(Start Frame Delimiter) : 다음 바이트로부터 MAC 주소가 시작됨을 알린다.
- DMAC, SMAC : 수신, 송신 MAC 주소
- EtherType : 데이터 계층 위의 계층인 IP 프로토콜 (IPv4, IPv6)
- Payload : 전달받은 데이터
- CRC : 에러 확인 비트

> ### 💟 MAC 주소
>
> 컴퓨터나 노트북 등 각 장치에는 네트워크에 연결하기 위한 장치(LAN 카드)가 있는데 이를 구별하기 위한 식별 번호

---

### 💙 계층 간 데이터 송수신 과정

![](https://velog.velcdn.com/images/samuel_/post/22ce5940-b4df-47d4-ae57-9daa685a2e5b/image.png) <br/>

컴퓨터를 통해 다른 컴퓨터로 데이터를 요청한다면 애플리케이션 계층에서 전송 계층으로 요청값들이 `캡슐화 과정`을 거쳐 전달되고, 링크 계층을 통해 해당 서버와 통신을 하고, 해당 서버의 링크 계층으로부터 애플리케이션까지 `비캡슐화 과정`을 거쳐 데이터가 전송된다.

#### 💟 캡슐화 과정

상위 계층의 헤더와 데이터를 하위 계층의 데이터 부분에 포함시키고 해당 계층의 헤더를 삽입하는 과정
![](https://velog.velcdn.com/images/samuel_/post/a243d36f-99c5-4510-a218-307ec1f1f93a/image.png)

#### 💟 비캡슐화 과정

하위 계층에서 상위 계층으로 가며 각 계층의 헤더 부분을 제거하는 과정
![](https://velog.velcdn.com/images/samuel_/post/3bf6ea3b-b370-4c53-a839-07a5e20f6317/image.png)
캡슐화된 데이터를 받게 되면 링크 계층으로부터 타고 올라오면서 `프레임화 된 데이터`는 다시 패킷화를 거쳐 비캡슐화 과정이 일어난다.

## 2.2.2. PDU

네트워크의 어떠한 계층에서 계층으로 데이터가 전달될 때 한 덩어리의 단위를 `PDU(Protocol Data Unit)` 이라고 한다.

PDU 는 제어 관련 정보들이 포함된 헤더와 데이터를 의미하는 페이로드로 구성되어 있으며 계층마다 부르는 명칭이 다른데,

- 애플리케이션 계층 : 메시지
- 전송계층 : 세그먼트, 데이터 그램
- 인터넷 계층 : 패킷
- 링크 계층 : 프레임 (데이터 링크 계층), 비트(물리 계층)
